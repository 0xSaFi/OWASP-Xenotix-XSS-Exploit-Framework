Imports CefSharp.WinForms
Imports CefSharp

Public Class xss_fuzzer
    Dim i As Integer = 0
    Dim fuzzurl As String
    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click

        Try
            If TextBox2.Text < 1 Then
                MsgBox("Time Interval should not be less than 1 sec", vbInformation)
            ElseIf furl.Text = "" Then
                MsgBox("Please provide an URL", vbInformation)
            ElseIf Not (furl.Text.Contains("[X]")) Then
                MsgBox("Add [X] to start fuzzing on a parameter or a value", vbInformation)
            Else

                If furl.Text.StartsWith("http://") Then
                    furl.Text = furl.Text.Replace("http://", "")
                    protocol.Text = "http://"
                ElseIf furl.Text.StartsWith("https://") Then
                    furl.Text = furl.Text.Replace("https://", "")
                    protocol.Text = "https://"
                End If

                Dim t As Integer = Convert.ToInt32(TextBox2.Text)
                t = t * 1000
                Timer1.Interval = t
                Timer1.Enabled = True
                Button1.Enabled = False
                'xenotix_main.add_detection_timer.Enabled = True
            End If

        Catch
            MsgBox("Please provide a suitable URL to start fuzzing", vbInformation)
        End Try

    End Sub

    Private Sub Button6_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button6.Click
        On Error Resume Next

        Timer1.Enabled = False
        Me.Close()
    End Sub

    Private Sub Timer1_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer1.Tick
        On Error Resume Next

        If (i <= xenotix_main.RichTextBox1.Lines.Length) Then
            If (i = xenotix_main.RichTextBox1.Lines.Length) Then
                cnt.Text = xenotix_main.RichTextBox1.Lines.Length
            Else
                cnt.Text = i + 1
            End If
            xenotix_main.textxss.Text = xenotix_main.RichTextBox1.Lines(i)
            fuzzurl = furl.Text
            fuzzurl = protocol.Text + fuzzurl.Replace("[X]", xenotix_main.textxss.Text)
            xenotix_main.final.Text = (fuzzurl)
            If xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = True Then
                xenotix_main.web.Url = New Uri(xenotix_main.final.Text)
                xenotix_main.gecko.Navigate(xenotix_main.final.Text)
                xenotix_main.webkit.Load(xenotix_main.final.Text)
            ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = False Then
                MsgBox("Select atleast 1 Browser Engine", vbInformation)

                Me.Close()
            ElseIf xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = False Then
                xenotix_main.web.Url = New Uri(xenotix_main.final.Text)
                xenotix_main.webkit.Load(xenotix_main.final.Text)
            ElseIf xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = False Then
                xenotix_main.web.Url = New Uri(xenotix_main.final.Text)
            ElseIf xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = True Then
                xenotix_main.web.Url = New Uri(xenotix_main.final.Text)
                xenotix_main.gecko.Navigate(xenotix_main.final.Text)
            ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = True Then
                xenotix_main.gecko.Navigate(xenotix_main.final.Text)
            ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = False Then
                xenotix_main.webkit.Load(xenotix_main.final.Text)
            ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = True Then
                xenotix_main.gecko.Navigate(xenotix_main.final.Text)
                xenotix_main.webkit.Load(xenotix_main.final.Text)
            End If

            i = i + 1
        Else
            Timer1.Enabled = False
            MsgBox("Test Finished!", vbInformation)
            i = 0
            cnt.Text = i
        End If
    End Sub

    Private Sub xss_fuzzer_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        On Error Resume Next
        tcount.Text = xenotix_main.RichTextBox1.Lines.Length
    End Sub
End Class