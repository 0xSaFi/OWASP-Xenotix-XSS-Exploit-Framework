Imports System.Net
Imports System.Text
Imports System.IO
Public Class xss_header_injector

    Dim i As Integer = 0
    Dim oparam, omethod, oabs, oproto, ohost, oref, ousr, oacpt, octype, urlz As String
    Dim x As String

    Public login As New CookieContainer

    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
        On Error Resume Next

        Dim flg As Integer = 0
        If TextBox3.Text < 1 Then
            MsgBox("Time Interval should not be less than 1 sec", vbInformation)
            flg = 1
        End If
        If Not (method.Text.Contains("[X]") Or abs.Text.Contains("[X]") Or host.Text.Contains("[X]") Or ref.Text.Contains("[X]") Or usr.Text.Contains("[X]") Or acpt.Text.Contains("[X]") Or ctyp.Text.Contains("[X]") Or cntnt.Text.Contains("[X]")) Then
            MsgBox("Replace the Element with [X] to start testing.", vbInformation)
            flg = 1
        End If
      
        If flg = 0 Then
            oparam = cntnt.Text
            omethod = method.Text
            oabs = abs.Text
            oproto = proto.Text
            ohost = host.Text
            oref = ref.Text
            ousr = usr.Text
            oacpt = acpt.Text
            octype = ctyp.Text

            Dim t As Integer = Convert.ToInt32(TextBox3.Text)
            t = t * 1000
            Timer1.Interval = t
            Timer1.Enabled = True
            Button1.Enabled = False

        End If
    End Sub


    Private Sub post_scanner_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        On Error Resume Next
        tcount.Text = xenotix_main.payloadcounter.Text

    End Sub

    Private Sub Button2_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button2.Click
        On Error Resume Next
        Timer1.Enabled = False
        Me.Close()
    End Sub

    Private Sub Timer1_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer1.Tick
        Try
            urlz = ComboBox1.Text + host.Text + abs.Text
            Dim tparam As String = ""
            Dim tempCookies As New CookieContainer

            If (i <= xenotix_main.RichTextBox1.Lines.Length) Then
                If (i = xenotix_main.RichTextBox1.Lines.Length) Then
                    cnt.Text = xenotix_main.RichTextBox1.Lines.Length
                Else
                    cnt.Text = i + 1
                End If

                xenotix_main.textxss.Text = xenotix_main.RichTextBox1.Lines(i)
                If method.Text.Contains("POST") Then
                    TextBox2.Text = ""
                    Try
                        tparam = oparam.Replace("[X]", xenotix_main.textxss.Text)
                        cntnt.Text = tparam
                        tparam = omethod.Replace("[X]", xenotix_main.textxss.Text)
                        method.Text = tparam
                        tparam = oabs.Replace("[X]", xenotix_main.textxss.Text)
                        abs.Text = tparam
                        tparam = ohost.Replace("[X]", xenotix_main.textxss.Text)
                        host.Text = tparam
                        tparam = oref.Replace("[X]", xenotix_main.textxss.Text)
                        ref.Text = tparam
                        tparam = ousr.Replace("[X]", xenotix_main.textxss.Text)
                        usr.Text = tparam
                        tparam = oacpt.Replace("[X]", xenotix_main.textxss.Text)
                        acpt.Text = tparam
                        tparam = octype.Replace("[X]", xenotix_main.textxss.Text)
                        ctyp.Text = tparam
                    Catch ex As Exception
                    End Try
                    Dim postReq As HttpWebRequest = DirectCast(WebRequest.Create(urlz), HttpWebRequest)
                    Dim encoding As New UTF8Encoding
                    Dim postData As String = cntnt.Text
                    Dim byteData As Byte() = encoding.GetBytes(postData)

                    'Proxy support
                    If CheckBox1.Checked = True Then
                        If xenotix_main.xenotix_proxy = 1 Then
                            Try
                                Dim myProxy As New WebProxy()
                                Dim newUri As New Uri("http://" & xenotix_gproxy.paddr & ":" & xenotix_gproxy.pport)
                                myProxy.Address = newUri
                                myProxy.Credentials = New NetworkCredential(xenotix_gproxy.puser, xenotix_gproxy.ppass)
                                postReq.Proxy = myProxy
                            Catch ex As Exception
                                MsgBox(ex.Message.ToString, vbCritical)
                            End Try
                        Else
                            xenotix_gproxy.Show()
                        End If
                    End If
                    postReq.Method = method.Text
                    postReq.KeepAlive = True
                    postReq.CookieContainer = tempCookies
                    postReq.Referer = ref.Text
                    postReq.ContentType = ctyp.Text
                    postReq.UserAgent = usr.Text
                    postReq.ContentLength = byteData.Length
                    clen.Text = byteData.Length
                    postReq.Accept = acpt.Text
                    postReq.Headers.Add("Keep-Alive", "115")
                    Try
                        Dim postreqstream As Stream = postReq.GetRequestStream()
                        postreqstream.Write(byteData, 0, byteData.Length)
                        postreqstream.Close()
                    Catch xx As Exception
                        MsgBox(xx.Message.ToString, vbCritical)
                    End Try
                    'RESPONSE
                    Try
                        Dim myHttpWebResponse As HttpWebResponse = DirectCast(postReq.GetResponse(), HttpWebResponse)
                        tempCookies.Add(myHttpWebResponse.Cookies)
                        TextBox2.Text = "HTTP/" + myHttpWebResponse.ProtocolVersion.ToString + " " + Str(myHttpWebResponse.StatusCode) + " " + myHttpWebResponse.StatusDescription.ToString + ControlChars.CrLf

                        Dim i As Integer
                        While i < myHttpWebResponse.Headers.Count
                            TextBox2.Text += myHttpWebResponse.Headers.Keys(i) + ":" + myHttpWebResponse.Headers(i) + ControlChars.CrLf
                            i = i + 1
                        End While
                        Dim postreqreader As New StreamReader(myHttpWebResponse.GetResponseStream, encoding)
                        x = postreqreader.ReadToEnd
                        myHttpWebResponse.Close()
                        Button3.Enabled = False
                    Catch xxx As Exception
                        TextBox2.Text = xxx.Message.ToString
                    End Try

                ElseIf method.Text.Contains("GET") Then
                    TextBox2.Text = ""
                    Try
                        tparam = oabs.Replace("[X]", xenotix_main.textxss.Text)
                        abs.Text = tparam
                        tparam = ohost.Replace("[X]", xenotix_main.textxss.Text)
                        host.Text = tparam
                        tparam = oref.Replace("[X]", xenotix_main.textxss.Text)
                        ref.Text = tparam
                        tparam = ousr.Replace("[X]", xenotix_main.textxss.Text)
                        usr.Text = tparam
                        tparam = oacpt.Replace("[X]", xenotix_main.textxss.Text)
                        acpt.Text = tparam

                    Catch ex As Exception
                    End Try
                    Try

                        Dim postReq As HttpWebRequest = CType(WebRequest.Create(urlz), HttpWebRequest)
                        If CheckBox1.Checked = True Then
                            If xenotix_main.xenotix_proxy = 1 Then
                                Try
                                    Dim myProxy As New WebProxy()
                                    Dim newUri As New Uri("http://" & xenotix_gproxy.paddr & ":" & xenotix_gproxy.pport)
                                    myProxy.Address = newUri
                                    myProxy.Credentials = New NetworkCredential(xenotix_gproxy.puser, xenotix_gproxy.ppass)
                                    postReq.Proxy = myProxy
                                Catch ex As Exception
                                    MsgBox(ex.Message.ToString, vbCritical)
                                End Try
                            Else
                                xenotix_gproxy.Show()
                            End If
                        End If


                        postReq.Method = method.Text
                        postReq.KeepAlive = True
                        postReq.CookieContainer = tempCookies
                        postReq.Referer = ref.Text
                        postReq.ContentType = ctyp.Text
                        postReq.UserAgent = usr.Text
                        postReq.Accept = acpt.Text
                        postReq.Headers.Add("Keep-Alive", "115")
                        'RESPONSE
                        Dim myHttpWebResponse As HttpWebResponse = CType(postReq.GetResponse(), HttpWebResponse)
                        TextBox2.Text += "HTTP/" + myHttpWebResponse.ProtocolVersion.ToString + " " + Str(myHttpWebResponse.StatusCode) + " " + myHttpWebResponse.StatusDescription.ToString + ControlChars.CrLf
                        Dim i As Integer
                        While i < myHttpWebResponse.Headers.Count
                            TextBox2.Text += myHttpWebResponse.Headers.Keys(i) + ":" + myHttpWebResponse.Headers(i) + ControlChars.CrLf
                            i = i + 1
                        End While

                        Dim postreqreader As New StreamReader(myHttpWebResponse.GetResponseStream)
                        x = postreqreader.ReadToEnd
                        myHttpWebResponse.Close()
                    Catch xxx As Exception
                        TextBox2.Text = xxx.Message.ToString
                    End Try
                Else
                    MsgBox("Unsupported Method!", vbCritical)
                    Me.Close()
                End If
                '============================

                Try

                    If xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = True Then
                        xenotix_main.web.DocumentText = x
                        xenotix_main.webkit.LoadHtml(x)
                        xenotix_main.gecko.LoadHtml(x)
                    ElseIf xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = False Then
                        xenotix_main.web.DocumentText = x
                        xenotix_main.webkit.LoadHtml(x)

                    ElseIf xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = False Then
                        xenotix_main.web.DocumentText = x

                    ElseIf xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = True Then
                        xenotix_main.web.DocumentText = x

                        xenotix_main.gecko.LoadHtml(x)
                    ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = True Then

                        xenotix_main.gecko.LoadHtml(x)
                    ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = False Then

                        xenotix_main.webkit.LoadHtml(x)

                    ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = True Then

                        xenotix_main.webkit.LoadHtml(x)
                        xenotix_main.gecko.LoadHtml(x)
                    End If
                Catch p As Exception
                End Try
                i = i + 1
            Else
                Timer1.Enabled = False
                MsgBox("Test Finished!", vbInformation)
                i = 0
                cnt.Text = i
            End If
        Catch exx As Exception
            MsgBox(exx.Message.ToString, vbCritical)
        End Try
    End Sub

    Private Sub CheckBox1_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CheckBox1.CheckedChanged
        If CheckBox1.Checked = True Then
            If xenotix_main.xenotix_proxy = 0 Then
                xenotix_gproxy.Show()
            End If
        End If
    End Sub

    Private Sub Button3_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button3.Click

        If host.Text = "" Then
            MsgBox("Provide a Host Name", vbCritical)
        Else
            urlz = ComboBox1.Text + host.Text + abs.Text

            Dim tempCookies As New CookieContainer
            If method.Text.Contains("POST") Then
                TextBox2.Text = ""
                Dim postReq As HttpWebRequest = DirectCast(WebRequest.Create(urlz), HttpWebRequest)
                Dim encoding As New UTF8Encoding
                Dim postData As String = cntnt.Text
                Dim byteData As Byte() = encoding.GetBytes(postData)
                'Proxy support
                If CheckBox1.Checked = True Then
                    If xenotix_main.xenotix_proxy = 1 Then
                        Try
                            Dim myProxy As New WebProxy()
                            Dim newUri As New Uri("http://" & xenotix_gproxy.paddr & ":" & xenotix_gproxy.pport)
                            myProxy.Address = newUri
                            myProxy.Credentials = New NetworkCredential(xenotix_gproxy.puser, xenotix_gproxy.ppass)
                            postReq.Proxy = myProxy
                        Catch ex As Exception
                            MsgBox(ex.Message.ToString, vbCritical)
                        End Try
                    Else
                        xenotix_gproxy.Show()
                    End If
                End If
                postReq.Method = method.Text
                postReq.KeepAlive = True
                postReq.CookieContainer = tempCookies
                postReq.Referer = ref.Text
                postReq.ContentType = ctyp.Text
                postReq.UserAgent = usr.Text
                postReq.ContentLength = byteData.Length
                clen.Text = byteData.Length
                postReq.Accept = acpt.Text
                postReq.Headers.Add("Keep-Alive", "115")
                Try
                    Dim postreqstream As Stream = postReq.GetRequestStream()
                    postreqstream.Write(byteData, 0, byteData.Length)
                    postreqstream.Close()
                Catch xx As Exception
                    MsgBox(xx.Message.ToString, vbCritical)
                End Try
                'RESPONSE
                Try

                    Dim myHttpWebResponse As HttpWebResponse = DirectCast(postReq.GetResponse(), HttpWebResponse)
                    tempCookies.Add(myHttpWebResponse.Cookies)
                    TextBox2.Text = "HTTP/" + myHttpWebResponse.ProtocolVersion.ToString + " " + Str(myHttpWebResponse.StatusCode) + " " + myHttpWebResponse.StatusDescription.ToString + ControlChars.CrLf

                    Dim i As Integer
                    While i < myHttpWebResponse.Headers.Count
                        TextBox2.Text += myHttpWebResponse.Headers.Keys(i) + ":" + myHttpWebResponse.Headers(i) + ControlChars.CrLf
                        i = i + 1
                    End While
                    Dim postreqreader As New StreamReader(myHttpWebResponse.GetResponseStream, encoding)
                    x = postreqreader.ReadToEnd
                    myHttpWebResponse.Close()
                Catch xxx As Exception
                    TextBox2.Text = xxx.Message.ToString
                End Try
            ElseIf method.Text.Contains("GET") Then
                TextBox2.Text = ""
                Try
                    Dim postReq As HttpWebRequest = CType(WebRequest.Create(urlz), HttpWebRequest)
                    If CheckBox1.Checked = True Then
                        If xenotix_main.xenotix_proxy = 1 Then
                            Try
                                Dim myProxy As New WebProxy()
                                Dim newUri As New Uri("http://" & xenotix_gproxy.paddr & ":" & xenotix_gproxy.pport)
                                myProxy.Address = newUri
                                myProxy.Credentials = New NetworkCredential(xenotix_gproxy.puser, xenotix_gproxy.ppass)
                                postReq.Proxy = myProxy
                            Catch ex As Exception
                                MsgBox(ex.Message.ToString, vbCritical)
                            End Try
                        Else
                            xenotix_gproxy.Show()
                        End If
                    End If


                    postReq.Method = method.Text
                    postReq.KeepAlive = True
                    postReq.CookieContainer = tempCookies
                    postReq.Referer = ref.Text
                    postReq.ContentType = ctyp.Text
                    postReq.UserAgent = usr.Text
                    postReq.Accept = acpt.Text
                    postReq.Headers.Add("Keep-Alive", "115")
                    'RESPONSE
                    Dim myHttpWebResponse As HttpWebResponse = CType(postReq.GetResponse(), HttpWebResponse)
                    TextBox2.Text += "HTTP/" + myHttpWebResponse.ProtocolVersion.ToString + " " + Str(myHttpWebResponse.StatusCode) + " " + myHttpWebResponse.StatusDescription.ToString + ControlChars.CrLf
                    Dim i As Integer
                    While i < myHttpWebResponse.Headers.Count
                        TextBox2.Text += myHttpWebResponse.Headers.Keys(i) + ":" + myHttpWebResponse.Headers(i) + ControlChars.CrLf
                        i = i + 1
                    End While

                    Dim postreqreader As New StreamReader(myHttpWebResponse.GetResponseStream)
                    x = postreqreader.ReadToEnd
                    myHttpWebResponse.Close()
                Catch xxx As Exception
                    TextBox2.Text = xxx.Message.ToString
                End Try
            Else
                MsgBox("Unsupported Method!", vbCritical)
                Me.Close()
            End If


            Try

                If xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = True Then
                    xenotix_main.web.DocumentText = x
                    xenotix_main.webkit.LoadHtml(x)
                    xenotix_main.gecko.LoadHtml(x)
                ElseIf xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = False Then
                    xenotix_main.web.DocumentText = x
                    xenotix_main.webkit.LoadHtml(x)

                ElseIf xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = False Then
                    xenotix_main.web.DocumentText = x

                ElseIf xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = True Then
                    xenotix_main.web.DocumentText = x

                    xenotix_main.gecko.LoadHtml(x)
                ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = True Then

                    xenotix_main.gecko.LoadHtml(x)
                ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = False Then

                    xenotix_main.webkit.LoadHtml(x)

                ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = True Then

                    xenotix_main.webkit.LoadHtml(x)
                    xenotix_main.gecko.LoadHtml(x)
                End If
            Catch p As Exception
            End Try
        End If
    End Sub

  
    Private Sub method_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles method.SelectedIndexChanged
        If method.Text = "GET" Then
            cntnt.Enabled = False
            ctyp.Enabled = False
        Else
            cntnt.Enabled = True
            ctyp.Enabled = True
        End If
    End Sub
End Class