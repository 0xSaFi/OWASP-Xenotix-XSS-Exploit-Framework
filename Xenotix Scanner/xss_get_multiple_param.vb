Imports CefSharp.WinForms
Imports CefSharp

Public Class xss_get_multiple_param
    Dim ques() As String
    Dim param() As String
    Dim testparam As String
    Dim firstparam As String

    Dim j As Integer = 0 'params other than ?
    Dim x As Integer = 0
    Dim y As Integer = 1 ' for t1()
    Dim flag As Integer = 0
    Dim ctr As Integer = 0 'counter
    Private Sub Button2_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button2.Click
        ListBox1.Items.Remove(ListBox1.SelectedItem)

    End Sub

    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
        Dim input As String
        input = InputBox("Enter the Parameter to Add")
        If input = "" Then
        ElseIf (input.Contains("&") Or input.Contains("?")) And input.Contains("=") Then
            ListBox1.Items.Add(input)
            TextBox1.Text = TextBox1.Text & input
        Else
            MsgBox("This is not a valid parameter format")
        End If
    End Sub

    Private Sub Button3_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button3.Click

        ListBox1.Items.Clear()
        Dim ques() As String
        Dim param() As String
        Dim s As String = TextBox1.Text
        Dim c As Char
        If TextBox1.Text = "" Or TextBox1.Text = " " Or TextBox1.Text = "http://" Then
            MsgBox("Please provide a valid URL", vbInformation)
        ElseIf (Not (TextBox1.Text.Contains("http://") Or TextBox1.Text.Contains("https://"))) Then
            MsgBox("Invalid URL", vbCritical)
        Else
            Button1.Enabled = True
            Button2.Enabled = True
            Button4.Enabled = True
            Button10.Enabled = True


            Button7.Enabled = True
            Button8.Enabled = True
            Button9.Enabled = True
            Button11.Enabled = True
            If (s.Contains("?")) Then
                s = s.Substring(s.IndexOf("?"))
                ques = s.Split("=")
                ques(0) = ques(0) & "="
                'add first parmeter
                ListBox1.Items.Add(ques(0))
            End If
            If (s.Contains("&")) Then
                s = s.Substring(s.IndexOf("&"))
                param = s.Split("&")
                For count = 1 To param.Length - 1
                    param(count) = "&" & param(count)
                Next

                For count = 0 To param.Length - 1
                    Dim str As String
                    For i = 1 To Len(param(count))
                        str = ""
                        c = Mid(param(count), i, 1)

                        If c = "&" Then
                            While c <> "="
                                str = str & c
                                i = i + 1
                                c = Mid(param(count), i, 1)

                            End While
                            param(count) = str & "="
                            'rest of all parameters
                            ListBox1.Items.Add(param(count))
                        End If
                    Next
                Next
            End If
        End If

    End Sub

    Private Sub Form16_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        On Error Resume Next
        Me.Show()
        TextBox1.Focus()
        xenotix_main.web.Stop()
        tcount.Text = xenotix_main.RichTextBox1.Lines.Length

        Button7.Enabled = False
        Button8.Enabled = False
        Button9.Enabled = False
        Button10.Enabled = False
        Button11.Enabled = False
    End Sub

    Private Sub TextBox1_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TextBox1.TextChanged

    End Sub

    Private Sub Button4_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button4.Click
        ListBox1.Items.Clear()
    End Sub



    Private Sub Button6_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button6.Click
        On Error Resume Next
        Timer1.Enabled = False
        Me.Close()
    End Sub

    Public Sub Timer1_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer1.Tick
        On Error Resume Next

        If j <= CheckedListBox1.Items.Count - 1 Then
            If x > xenotix_main.RichTextBox1.Lines.Length Then
                x = 0
                ctr = 0
                CheckedListBox1.SetItemChecked(j, True)
                flag = 1
                y = y + 1
                j = j + 1
            Else
                'xenotix_main.add_detection_timer.Enabled = True
                Dim s = TextBox1.Text
                Dim url = TextBox1.Text
                Dim t1() As String
                firstparam = CheckedListBox1.Items(0).ToString()

                If (s.Contains("?")) Then
                    s = s.Substring(s.IndexOf("?"))
                    url = url.Replace(s, "")
                    'url
                    t1 = s.Split("&")
                    For tt = 1 To t1.Length - 1
                        t1(tt) = "&" & t1(tt)
                        ' MsgBox(t1(tt))
                    Next
                    'url - attack parameter
                    If flag = 0 Then
                        xenotix_main.textxss.Text = xenotix_main.RichTextBox1.Lines(x)
                        Dim attackv = url & firstparam & xenotix_main.textxss.Text
                        For pp = 1 To t1.Length - 1
                            attackv = attackv & t1(pp)
                        Next
                        ' MsgBox(attackv)
                        'url+parameter+vector+remaing
                        xenotix_main.final.Text = attackv
                        If xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = True Then
                            xenotix_main.web.Url = New Uri(xenotix_main.final.Text)
                            xenotix_main.gecko.Navigate(xenotix_main.final.Text)
                            xenotix_main.webkit.Load(xenotix_main.final.Text)
                        ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = False Then
                            MsgBox("Select atleast 1 Browser Engine", vbInformation)

                            Me.Close()
                        ElseIf xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = False Then
                            xenotix_main.web.Url = New Uri(xenotix_main.final.Text)
                            xenotix_main.webkit.Load(xenotix_main.final.Text)
                        ElseIf xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = False Then
                            xenotix_main.web.Url = New Uri(xenotix_main.final.Text)
                        ElseIf xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = True Then
                            xenotix_main.web.Url = New Uri(xenotix_main.final.Text)
                            xenotix_main.gecko.Navigate(xenotix_main.final.Text)
                        ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = True Then
                            xenotix_main.gecko.Navigate(xenotix_main.final.Text)
                        ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = False Then
                            xenotix_main.webkit.Load(xenotix_main.final.Text)
                        ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = True Then
                            xenotix_main.gecko.Navigate(xenotix_main.final.Text)
                            xenotix_main.webkit.Load(xenotix_main.final.Text)
                        End If


                    ElseIf flag = 1 Then
                        testparam = CheckedListBox1.Items(j).ToString()
                        'MsgBox(testparam)
                        xenotix_main.textxss.Text = xenotix_main.RichTextBox1.Lines(x)
                        Dim attackv = url & t1(0) & testparam & xenotix_main.textxss.Text
                        For pp = 1 To t1.Length - 1
                            If t1(pp).Contains(testparam) Then
                            Else
                                attackv = attackv & t1(pp)
                            End If
                        Next

                        xenotix_main.final.Text = attackv
                        If xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = True Then
                            xenotix_main.web.Url = New Uri(xenotix_main.final.Text)
                            xenotix_main.gecko.Navigate(xenotix_main.final.Text)
                            xenotix_main.webkit.Load(xenotix_main.final.Text)
                        ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = False Then
                            MsgBox("Select atleast 1 Browser Engine", vbInformation)

                            Me.Close()
                        ElseIf xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = False Then
                            xenotix_main.web.Url = New Uri(xenotix_main.final.Text)
                            xenotix_main.webkit.Load(xenotix_main.final.Text)
                        ElseIf xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = False Then
                            xenotix_main.web.Url = New Uri(xenotix_main.final.Text)
                        ElseIf xenotix_main.ie.Checked = True And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = True Then
                            xenotix_main.web.Url = New Uri(xenotix_main.final.Text)
                            xenotix_main.gecko.Navigate(xenotix_main.final.Text)
                        ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = False And xenotix_main.ff.Checked = True Then
                            xenotix_main.gecko.Navigate(xenotix_main.final.Text)
                        ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = False Then
                            xenotix_main.webkit.Load(xenotix_main.final.Text)
                        ElseIf xenotix_main.ie.Checked = False And xenotix_main.gc.Checked = True And xenotix_main.ff.Checked = True Then
                            xenotix_main.gecko.Navigate(xenotix_main.final.Text)
                            xenotix_main.webkit.Load(xenotix_main.final.Text)
                        End If

                    End If
                    ctr = ctr + 1
                    If ctr > tcount.Text Then
                        cnt.Text = ctr - 1
                    Else
                        cnt.Text = ctr
                    End If

                    x = x + 1

                End If
            End If

        Else
            Timer1.Enabled = False

            MsgBox("Scan Finished", vbInformation)
            Button10.Enabled = False
            Button7.Enabled = False
            Button8.Enabled = False
            Button9.Enabled = False
            Button11.Enabled = False
            cnt.Text = 0
            ctr = 0
            x = 0
        End If

    End Sub

    Private Sub Button7_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)



    End Sub

    Private Sub Button10_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button10.Click
        On Error Resume Next
        If TextBox2.Text < 1 Then
            MsgBox("Time interval should not be less than 1 sec", vbInformation)
        Else
            Button1.Enabled = False
            Button4.Enabled = False
            Button2.Enabled = False
            Button3.Enabled = False
            Button10.Enabled = False
            'enable automode
            Button7.Enabled = True
            Button8.Enabled = True
            Button9.Enabled = True
            Button11.Enabled = True
            Dim t As Integer = Convert.ToInt32(TextBox2.Text)
            t = t * 1000
            Timer1.Interval = t
            Timer1.Enabled = True
            CheckedListBox1.Items.Clear()
            For i As Integer = 0 To ListBox1.Items.Count - 1
                CheckedListBox1.Items.Add(ListBox1.Items(i).ToString)
                If Not TextBox1.Text.Contains(ListBox1.Items(i).ToString) Then
                    TextBox1.Text = TextBox1.Text & ListBox1.Items(i).ToString
                End If
            Next

        End If



    End Sub

    Private Sub Button8_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button8.Click
        On Error Resume Next
        If ctr <= tcount.Text Then
            ctr = ctr + 1
            x = x + 1
            cnt.Text = ctr + 1

        End If
    End Sub

    Private Sub Button7_Click_1(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button7.Click
        On Error Resume Next
        Dim y As Integer = InputBox("Enter the Payload position index", "Skip to Payload")
        If y <= tcount.Text Then
            ctr = y
            x = y
            cnt.Text = y
        Else
            MsgBox("Invalid Payload index!", vbCritical)
        End If
    End Sub

    Private Sub Button11_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button11.Click
        On Error Resume Next
        Timer1.Enabled = True
        Button11.Visible = False
        Button9.Visible = True
    End Sub

    Private Sub Button9_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button9.Click
        On Error Resume Next
        Timer1.Enabled = False
        Button11.Visible = True
        Button9.Visible = False
    End Sub
End Class